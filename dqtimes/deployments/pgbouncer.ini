; =============================================
; PGBOUNCER CONFIGURATION - PROJETO FACULDADE
; =============================================

[databases]
; Configuração do banco de dados principal
faculdade_db = host=localhost port=5432 dbname=faculdade_db
; Para múltiplos bancos (exemplo):
; outro_db = host=localhost port=5432 dbname=outro_db

[pgbouncer]

; =======================
; CONFIGURAÇÕES BÁSICAS
; =======================

; Endereço e porta onde o PgBouncer escuta
listen_addr = *
listen_port = 6432

; Arquivo de autenticação (usuários/senhas)
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Usuário administrativo do PgBouncer
admin_users = admin
stats_users = stats, admin

; =======================
; CONFIGURAÇÃO DO POOL
; =======================

; Modo de pooling: transaction (recomendado para FastAPI)
pool_mode = transaction

; Conexões máximas de clientes
max_client_conn = 1000

; Tamanho do pool por database/server
default_pool_size = 25

; Pool reserva para picos de carga
reserve_pool_size = 10
reserve_pool_timeout = 5

; Tamanho mínimo do pool (opcional)
; min_pool_size = 5

; Número máximo de conexões do PgBouncer para o PostgreSQL
max_db_connections = 100

; =======================
; TIMEOUTS
; =======================

; Tempo que uma conexão pode ficar idle antes de ser fechada
server_idle_timeout = 300

; Tempo máximo de vida de uma conexão com o PostgreSQL
server_lifetime = 3600

; Timeout para estabelecer conexão com o PostgreSQL
server_connect_timeout = 15

; Timeout para login no PostgreSQL
server_login_retry = 15

; Timeout para queries lentas (0 = desabilitado)
query_timeout = 0

; Timeout para clientes idle
client_idle_timeout = 0

; =======================
; LOGGING E MONITORAMENTO
; =======================

; Nível de log (verbose, debug, info, notice, warning, error)
syslog = 0
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1

; Período para coletar estatísticas (em segundos)
stats_period = 60

; Log de queries (cuidado: pode ser verboso)
; log_stats = 1
; verbose = 0

; =======================
; SEGURANÇA
; =======================

; Ignorar parâmetros de startup desnecessários
ignore_startup_parameters = extra_float_digits

; Usar usuário específico para conexões
; pgbouncer_user = pgbouncer

; Configurações de TLS/SSL (opcional para produção)
; client_tls_sslmode = require
; client_tls_key_file = /path/to/key
; client_tls_cert_file = /path/to/cert
; client_tls_ca_file = /path/to/ca

; =======================
; OTIMIZAÇÕES DE PERFORMANCE
; =======================

; Número máximo de packets por transação
pkt_buf = 4096

; Buffer para dados grandes
max_packet_size = 4096

; Modo de desconexão (session, query)
server_reset_query = DISCARD ALL

; Reutilização de conexões
server_round_robin = 0

; =======================
; CONFIGURAÇÕES AVANÇADAS
; =======================

; Tunning para muitos bancos pequenos
; max_client_conn = 2000
; default_pool_size = 20

; Para aplicações com muitas transações curtas
; reserve_pool_timeout = 3

; Para aplicações com queries longas
; server_idle_timeout = 600
; query_timeout = 300

; =======================
; CONFIGURAÇÃO DO CONSOLE ADMIN
; =======================

; Console administrativo (desabilitado por padrão)
; unix_socket_dir = /tmp
; unix_socket_mode = 0777
; unix_socket_group =

; =============================================
; CONFIGURAÇÕES ESPECÍFICAS PARA FASTAPI
; =============================================

; Otimizado para aplicações web com muitas transações curtas
application_name_add_host = 1

; Melhor para conexões assíncronas
client_idle_timeout = 0

; Adequado para SQLAlchemy async
server_reset_query_always = 0